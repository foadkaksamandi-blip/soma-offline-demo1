🪙 SOMA Offline Demo — Smart Bluetooth Payment Prototype

🎯 هدف پروژه

این دمو نسخه‌ی نمایشی (Proof of Concept) از ماژول پرداخت آفلاین سوما (SOMA) است؛ سیستمی که به کاربران اجازه می‌دهد بدون نیاز به اینترنت یا سرور بانکی، تراکنش‌های مالی را به‌صورت مستقیم، امن و بلادرنگ از طریق Bluetooth یا QR Code بین دو دستگاه (خریدار و فروشنده) انجام دهند.

هدف اصلی دمو، نمایش عملی عملکرد سیستم سوما در حالت آفلاین است تا بانک‌ها، تیم‌های فنی و سرمایه‌گذاران بتوانند کل فرآیند را در مقیاس واقعی مشاهده و ارزیابی کنند.

---

⚙️ ساختار دمو

دمو شامل دو اپلیکیشن مستقل اما متصل به‌هم است:

1. SOMA Buyer App

مدیریت موجودی آفلاین (Local Balance Store)

ارسال مبلغ پرداخت از طریق بلوتوث یا QR

ثبت خودکار تراکنش و کاهش موجودی

نمایش تاریخچه تراکنش‌ها با شناسه یکتا (Txn ID)

2. SOMA Seller App

دریافت مبلغ از خریدار

تأیید اتصال امن و دریافت وجه

ثبت تراکنش با کد تأیید یکتا

نمایش رسید محلی و به‌روزرسانی موجودی فروشنده

---

🔌 روش‌های ارتباط

دمو از دو روش ارتباطی برای تراکنش‌ها پشتیبانی می‌کند:

Bluetooth Secure Channel (BLE+)
ارتباط مستقیم بین دو اپلیکیشن، بدون نیاز به اینترنت یا Wi-Fi.
تراکنش پس از Pair شدن امن، در کمتر از چند ثانیه انجام می‌شود.

QR Code Mode
فروشنده مبلغ را به‌صورت QR تولید می‌کند.
خریدار با اسکن کد، به‌صورت خودکار به فروشنده متصل و پرداخت را انجام می‌دهد.

---

🔐 ویژگی‌های امنیتی

تبادل داده با رمزنگاری محلی (AES + KeyPair)

هر تراکنش دارای شناسه یکتا و امضا شده است

داده‌ها در حافظه رمزگذاری‌شده (Encrypted SharedPrefs) ذخیره می‌شوند

هیچ داده حساسی در شبکه ارسال نمی‌شود

---

📊 ساختار فنی

زبان: Flutter (Dart)

پایگاه‌داده: SQLite محلی برای موجودی

کانال ارتباطی: Bluetooth Low Energy (BLE) + QR

Dependencyهای کلیدی:

flutter_blue_plus برای مدیریت بلوتوث

permission_handler برای دسترسی به BLE

qr_flutter و qr_code_scanner برای QR

---

📱 نحوه عملکرد

1. خریدار و فروشنده هر دو اپ را اجرا می‌کنند.

2. هر دو دستگاه از طریق بلوتوث Pair می‌شوند یا خریدار QR فروشنده را اسکن می‌کند.

3. فروشنده مبلغ را تعیین می‌کند.

4. خریدار تراکنش را تأیید می‌کند.

5. مبلغ از موجودی خریدار کم و به موجودی فروشنده اضافه می‌شود.

6. هر دو طرف رسید محلی با شناسه تراکنش دریافت می‌کنند.

---

🧩 اجزای اصلی کدنویسی

balance_store.dart → مدیریت موجودی‌ها

ble_buyer.dart / ble_seller.dart → منطق بلوتوث

qr_utils.dart → تولید و اسکن QR

buyer_main.dart / seller_main.dart → رابط کاربری و هماهنگی کل سیستم

---

🧭 نتیجه مورد انتظار

پس از اجرای موفق، هر دو اپلیکیشن بدون نیاز به اینترنت قادر خواهند بود:

به‌صورت امن به هم متصل شوند،

مبلغ را انتقال دهند،

رسید محلی ثبت و نمایش دهند،

و سابقه تراکنش‌ها را ذخیره کنند.

---

💡 هدف نهایی

این دمو پایه‌ی نسخه‌ی بانکی و تجاری سوما است که در آینده به زیرساخت‌های بانکی متصل خواهد شد تا پرداخت‌های آفلاین در شرایط اضطراری (قطع اینترنت، بحران‌ها، یا مناطق دورافتاده) برای همه کاربران قابل انجام باشد.

**نحوه راه‌اندازی:**
1. `flutter pub get` در هر فولدر.
2. بلوتوث رو فعال کن.
3. Seller: مبلغ وارد کن، QR بساز یا advertise کن.
4. Buyer: اسکن QR یا connect BLE، پرداخت کن.
